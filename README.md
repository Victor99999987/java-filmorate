# Групповой проект команды №1

* * *

## Состав команды:

* Воложанин Виктор **/ тимлид**
* Карпова Елизавета
* Лаптева Евгения
* Жеребцов Артем
* Пожидаев Иван
* Евтюхин Дмитрий

* * *
## Функциональность

### Отзывы
Появилась возможность оставлять отзывы к фильмам.
Характеристики отзыва:
1. Оценка — полезный/бесполезный (пользователи, прочитавшие отзыв, могут оценить его, то есть поставить лайк или дизлайк).
2. Тип отзыва — негативный/позитивный (автор отзыва указывает, является ли его отзыв хвалебным или нет).
3. Рейтинг — полезность отзыва, вычисляется на основе оценок пользователей. Отзывы сортируются по рейтингу.
#### Список появившегося функционала:
1. Добавление нового отзыва.
2. Редактирование имеющегося отзыва.
3. Удаление отзыва.
4. Получение отзыва по идентификатору.
5. Получение списка отзывов по идентификатору фильма (если id фильма не указан то возвращаются отзывы с максимальным значением рейтинга). Если не указан размер списка, то по умолчанию это 10.
6. Возможность поставить и удалить лайк/дизлайк отзыву, тем самым изменив показатель полезности отзыва.
> Исполнитель: Евтюхин Дмитрий

### Режиссеры
Появилась возможность указывать режиссеров фильмов.
#### Список появившегося функционала:
1. Создание режиссера.
2. Изменение режиссера.
3. Получение списка всех фильмов режиссера в порядке убывания лайков.
4. Получение списка всех фильмов режиссера в хронологическом порядке.
5. Получение списка всех режиссеров.
6. Получение режиссёра по идентификатору.
> Исполнитель: Пожидаев Иван

### Лента событий
Добавлена возможность просмотра последних событий на платформе — добавление в друзья, удаление из друзей, лайки и отзывы, которые оставили друзья пользователя.
> Исполнитель: Воложанин Виктор

### Рекомендации
Реализована простая рекомендательную система для фильмов.
> Исполнитель: Жеребцов Артем

### Общие фильмы
Реализован вывод общих с другом фильмов с сортировкой по их популярности.
> Исполнитель: Лаптева Евгения

### Удаление фильмов и пользователей
Добавлен функционал для удаления фильма и пользователя по идентификатору.
> Исполнитель: на доске не указано ((

### Вывод самых популярных фильмов по жанру и года
Добавлен функционал для вывода топ-N фильмов по количеству лайков с фильтрацией по двум параметрам:
1. По жанру.
2. За указанный год.
> Исполнитель: Карпова Елизавета

### Поиск
Добавлен функционал для поиска фильмов по названию и по режиссёру.
> Исполнитель: Пожидаев Иван

ER-диаграмма проекта
![](/er_diagram/erd.png)

Данная схема позволяет делать основные запросы. Примеры запросов.

GET /users/{id}/friends

Получить список друзей по {id} пользователя
```
SELECT *
FROM users
WHERE users.id IN (
                   SELECT friend_id
                   FROM friendship
                   WHERE users_id = {id}
                   AND confirmed = true
                 );
```

Получение списка список друзей, общих с другим пользователем

GET /users/{id}/friends/common/{otherId} 

```
SELECT *
FROM users
WHERE users.id IN (
                   SELECT friend_id 
                   FROM friendship 
                   WHERE users_id = {id}
                   AND confirmed = true 
                   AND friend_id IN (
                                     SELECT friend_id 
                                     FROM friendship 
                                     WHERE users_id = {otherId}
                                     AND confirmed = true 
                                    )
                  );
```

Возвращает список из первых count фильмов по количеству лайков.

GET /films/popular?count={count}

```
SELECT films.id,
       films.name,
       films.description,
       films.releaseDate,
       films.duration,
       ratings.name AS rating,
       COUNT(films.id) AS likes
FROM films
INNER JOIN likes ON films.id = likes.films_id
INNER JOIN users ON users.id = likes.users_id
INNER JOIN ratings ON ratings.id = films.ratings_id
GROUP BY films.id
ORDER BY likes DESC
LIMIT {count}
```